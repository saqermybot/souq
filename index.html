<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Souq Syria</title>

  <!-- ✅ Cache busting (حتى على iOS) -->
  <link rel="stylesheet" href="./base.css?v=20260105_01">
  <link rel="stylesheet" href="./components.css?v=20260105_01">

  <!-- ✅ تثبيت الدارك مود -->
  <script>
    document.documentElement.setAttribute("data-theme", "dark");
  </script>

  <!-- ✅ (اختياري) Debug: يطبع أخطاء JS بالموبايل بالكونسول -->
  <script>
    window.addEventListener("error", function(e){
      console.warn("JS error:", e && e.message, e && e.error);
    });
    window.addEventListener("unhandledrejection", function(e){
      console.warn("Promise rejection:", e && e.reason);
    });
  </script>
</head>
<body>

  <header class="topbar">
    <div class="brand">
      <span class="dot"></span>
      Souq Syria
    </div>
    <div id="authBar" class="authbar"></div>
  </header>

  <main class="container">

    <!-- SEARCH + FILTERS -->
    <section class="card searchCard" id="searchCard">
      <div class="row searchRow">
        <button id="btnToggleFilters" class="ghost filterToggle" aria-expanded="false" title="إظهار/إخفاء الفلاتر">
          ☰
        </button>
        <input id="qSearch" placeholder="بحث عن إعلان..." />
      </div>

      <div class="grid" style="margin-top:10px">
        <select id="cityFilter"></select>
        <select id="catFilter"></select>
      </div>

      <div id="advancedFilters" class="advancedFilters" style="margin-top:10px">
        <div class="grid">
          <input id="minPrice" type="number" inputmode="numeric" placeholder="السعر من" />
          <input id="maxPrice" type="number" inputmode="numeric" placeholder="السعر إلى" />
        </div>

        <div class="grid" style="margin-top:10px">
          <select id="currencyFilter">
            <option value="">العملة (الكل)</option>
            <option value="SYP">SYP</option>
            <option value="USD">USD</option>
            <option value="EUR">EUR</option>
          </select>

          <select id="sortFilter">
            <option value="new">الأحدث</option>
            <option value="priceAsc">السعر ↑</option>
            <option value="priceDesc">السعر ↓</option>
          </select>
        </div>

        <div class="grid" style="margin-top:10px">
          <select id="typeFilter">
            <option value="">بيع/إيجار (الكل)</option>
            <option value="sale">بيع</option>
            <option value="rent">إيجار</option>
          </select>

          <select id="yearFilter">
            <option value="">سنة الصنع (الكل)</option>
          </select>
        </div>

        <div class="grid" style="margin-top:10px">
          <select id="estateKindFilter">
            <option value="">نوع العقار (الكل)</option>
            <option value="house">منزل</option>
            <option value="apartment">شقة</option>
            <option value="land">أرض</option>
            <option value="shop">محل</option>
          </select>

          <select id="roomsFilter">
            <option value="0">عدد الغرف (الكل)</option>
            <option value="1">1+</option>
            <option value="2">2+</option>
            <option value="3">3+</option>
            <option value="4">4+</option>
            <option value="5">5+</option>
          </select>
        </div>
      </div>

      <div class="row actions" style="margin-top:10px">
        <button id="btnApply" class="secondary">تطبيق</button>
        <button id="btnReset" class="ghost">مسح</button>
      </div>

      <div class="muted small" style="margin-top:8px">
        ملاحظة: الفلاتر المتقدمة تُفعَّل فقط عند الضغط على "تطبيق". البحث النصي يعمل مباشرة.
      </div>
    </section>

    <!-- LISTINGS -->
    <section class="card">
      <div class="sectionHead">
        <h3>الإعلانات</h3>
        <button id="btnMore" class="secondary">تحميل المزيد</button>
      </div>

      <div id="listings" class="cardsGrid"></div>

      <div id="emptyState" class="muted small" style="display:none;margin-top:10px">
        لا يوجد نتائج حالياً
      </div>
    </section>

    <!-- DETAILS PAGE -->
    <section id="detailsPage" class="page hidden">
      <div class="pageInner card">
        <div class="pageHead">
          <button id="btnBack" class="ghost">رجوع</button>
          <button id="btnShare" class="secondary">مشاركة</button>
        </div>

        <div class="gallery">
          <button id="gPrev" class="gbtn">‹</button>
          <img id="gImg" class="gimg" alt="image" />
          <button id="gNext" class="gbtn">›</button>
        </div>

        <div id="gDots" class="dots"></div>

        <h2 id="dTitle"></h2>
        <div class="muted" id="dMeta"></div>
        <div class="price" id="dPrice"></div>
        <p id="dDesc"></p>

        <div class="row actions">
          <button id="btnChat">مراسلة</button>
          <button id="btnDelete" class="danger" style="display:none">حذف الإعلان</button>
        </div>
      </div>
    </section>

    <!-- INBOX PAGE -->
    <section id="inboxPage" class="page hidden">
      <div class="pageInner card">
        <div class="pageHead">
          <button id="btnInboxBack" class="ghost">رجوع</button>
          <h3 style="margin:0">الرسائل</h3>
          <button id="btnInboxRefresh" class="secondary">تحديث</button>
        </div>

        <div id="inboxList" class="inboxList"></div>

        <div id="inboxEmpty" class="muted small" style="display:none;margin-top:10px">
          لا يوجد محادثات حالياً
        </div>
      </div>
    </section>

    <!-- ADD LISTING -->
    <section id="addBox" class="page hidden">
      <div class="pageInner card">
        <div class="pageHead">
          <button id="btnAddBack" class="ghost">رجوع</button>
          <div class="muted small" id="uploadStatus"></div>
        </div>

        <h2>إعلان جديد</h2>

        <input id="aTitle" placeholder="العنوان" />
        <textarea id="aDesc" placeholder="الوصف" rows="4"></textarea>

        <div class="grid">
          <input id="aPrice" type="number" placeholder="السعر" />
          <select id="aCurrency">
            <option value="SYP">SYP</option>
            <option value="USD">USD</option>
            <option value="EUR">EUR</option>
          </select>
        </div>

        <div class="grid">
          <select id="aCity"></select>
          <select id="aCat"></select>
        </div>

        <div class="muted small">اختر من 1 إلى 3 صور (حد أقصى 3)</div>
        <input id="aImages" type="file" accept="image/*" multiple />
        <div id="imgPreview" class="preview"></div>

        <div class="row actions">
          <button id="btnPublish">نشر</button>
          <button id="btnClear" class="secondary">مسح</button>
        </div>
      </div>
    </section>

    <!-- CHAT -->
    <section id="chatBox" class="page hidden">
      <div class="pageInner card">
        <div class="pageHead">
          <button id="btnChatBack" class="ghost">رجوع</button>
          <h3 id="chatTitle" style="margin:0">محادثة</h3>
        </div>

        <div id="chatMsgs" class="chatmsgs" aria-live="polite"></div>

        <div class="row">
          <input id="chatInput" placeholder="اكتب رسالة..." autocomplete="off" />
          <button id="btnSend" type="button">إرسال</button>
        </div>

        <!-- ✅ Debug صغير: يثبت إن الزر عم يشتغل (بتقدر تشيله لاحقاً) -->
        <div id="chatDebug" class="muted small" style="margin-top:6px;display:none"></div>

        <p class="muted small">المحادثات تُحذف تلقائيًا لاحقاً (ميزة قادمة).</p>
      </div>
    </section>

  </main>

  <!-- AUTH MODAL -->
  <div id="authModal" class="modal hidden">
    <div class="modalCard">
      <div class="modalHead">
        <div style="font-weight:900">تسجيل الدخول</div>
        <button id="btnCloseAuth" class="ghost">إغلاق</button>
      </div>

      <div class="row">
        <input id="email" placeholder="Email" autocomplete="email" />
      </div>

      <div class="row" style="margin-top:10px">
        <input id="password" type="password" placeholder="Password" autocomplete="current-password" />
      </div>

      <div class="row actions" style="margin-top:12px">
        <button id="btnLogin">دخول</button>
        <button id="btnRegister" class="secondary">تسجيل</button>
      </div>

      <button id="btnGoogle" class="secondary full" style="margin-top:10px">دخول عبر Google</button>
      <p class="muted small" style="margin-top:8px">Email + Google</p>
    </div>
  </div>

  <!-- IMAGE MODAL -->
  <div id="imgModal" class="imgModal hidden">
    <div class="imgTop">
      <div id="imgCounter" class="imgCounter"></div>
      <button id="imgClose" class="ghost">إغلاق</button>
    </div>

    <button id="imgPrev" class="imgNav">‹</button>
    <img id="imgFull" class="imgFull" alt="full" />
    <button id="imgNext" class="imgNav">›</button>
  </div>

  <!-- ✅ Cache busting -->
  <script type="module" src="./app.js?v=chatfix_final_01"></script>
</body>
</html>